<!DOCTYPE html>
<html>
  <head>
    <title>MeotoLog</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-gray-50 text-gray-800 font-sans">
    
    <!-- ▼ ヘッダー（常に表示） -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
      <div class="w-full max-w-6xl mx-auto px-4 h-14 flex justify-between items-center">
        <!-- ロゴ -->
        <%= link_to root_path, class: "font-bold text-xl text-indigo-600 tracking-tight" do %>
          Meoto-Log
        <% end %>

        <!-- 右側のメニュー（ログイン状態で切り替え） -->
        <div class="text-sm">
          <% if user_signed_in? %>
            <!-- ログイン中：ログアウトボタン -->
            <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete }, class: "text-gray-500 hover:text-gray-700" %>
          <% else %>
            <!-- 未ログイン：ログインボタン -->
            <%= link_to "ログイン", new_user_session_path, class: "text-indigo-600 font-bold mr-3" %>
            <%= link_to "新規登録", new_user_registration_path, class: "bg-indigo-600 text-white px-3 py-1.5 rounded-full text-xs font-bold hover:bg-indigo-700" %>
          <% end %>
        </div>
      </div>
    </header>

    <!-- ▼ フラッシュメッセージ（通知） -->
    <% if notice %>
      <p class="bg-blue-50 text-blue-700 px-4 py-2 text-sm text-center"><%= notice %></p>
    <% end %>
    <% if alert %>
      <p class="bg-red-50 text-red-700 px-4 py-2 text-sm text-center"><%= alert %></p>
    <% end %>

    <!-- ▼ メインコンテンツ -->
    <main class="pb-20"> <!-- ボトムナビの分だけ下に余白 -->
      <%= yield %>
    </main>

    <!-- ▼ スマホ用ボトムナビゲーション（ログイン時のみ表示） -->
    <% if user_signed_in? %>
      <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around items-center py-2 z-40 pb-safe">
        
        <!-- ホーム -->
        <%= link_to root_path, class: "flex flex-col items-center w-full py-1 text-gray-400 hover:text-indigo-600 transition #{current_page?(root_path) ? 'text-indigo-600' : ''}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mb-0.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
          </svg>
          <span class="text-[10px] font-bold">ホーム</span>
        <% end %>

        <!-- 相談する（真ん中の目立つボタン） -->
       <%= link_to "#", onclick: "if(window.openModal){window.openModal();return false;} else {window.location.href='/'}", class: "flex flex-col items-center w-full relative group z-50" do %>
  <div class="bg-indigo-600 text-white rounded-full p-3 absolute -top-6 border-4 border-white shadow-lg group-hover:bg-indigo-700 transition">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z" />
            </svg>
          </div>
          <span class="text-[10px] font-bold text-indigo-600 mt-9">相談</span>
        <% end %>

        <!-- 相談ログ -->
        <%= link_to consultations_path, class: "flex flex-col items-center w-full py-1 text-gray-400 hover:text-indigo-600 transition #{current_page?(consultations_path) ? 'text-indigo-600' : ''}" do %>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mb-0.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
          </svg>
          <span class="text-[10px] font-bold">相談ログ</span>
        <% end %>

      </nav>
    <% end %>

  </body>
</html>

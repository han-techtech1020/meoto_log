<div class="bg-gray-100 min-h-screen flex flex-col">
  <!-- ヘッダー -->
  <div class="bg-white shadow px-4 py-3 flex items-center sticky top-0 z-10">
    <%= link_to consultations_path, class: "text-gray-600 mr-4" do %>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
      </svg>
    <% end %>
    <h1 class="font-bold text-lg text-gray-800">分析結果詳細</h1>
  </div>

  <!-- チャットエリア -->
  <div class="flex-1 overflow-y-auto p-4 space-y-6 pb-20">
    
    <!-- ユーザー（右側） -->
    <div class="flex justify-end">
      <div class="max-w-[80%]">
        <div class="bg-green-500 text-white p-3 rounded-l-2xl rounded-tr-2xl rounded-br-none shadow text-sm leading-relaxed">
          <%= @consultation.content %>
        </div>
        <div class="text-right text-xs text-gray-400 mt-1">
          <%= @consultation.created_at.strftime("%H:%M") %>・既読
        </div>
      </div>
    </div>

    <!-- AI（左側） -->
    <div class="flex justify-start">
      <!-- アイコン（あれば） -->
      <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center mr-2 flex-shrink-0">
        🤖
      </div>
      <div class="max-w-[85%]">
        <div class="text-xs text-gray-500 mb-1 ml-1">AIアドバイザー</div>
        <div class="bg-white text-gray-800 p-4 rounded-r-2xl rounded-tl-2xl rounded-bl-none shadow text-sm leading-relaxed space-y-3">
          
          <!-- 危険度表示 -->
          <div class="border-b pb-2 mb-2">
            <span class="text-xs font-bold text-gray-500">妻の怒り危険度</span>
            <div class="flex items-center mt-1">
              <div class="w-full bg-gray-200 rounded-full h-2.5 mr-2">
                <% color_class = @consultation.risk_score > 70 ? 'bg-red-500' : (@consultation.risk_score > 30 ? 'bg-yellow-400' : 'bg-blue-500') %>
                <div class="<%= color_class %> h-2.5 rounded-full" style="width: <%= @consultation.risk_score %>%"></div>
              </div>
              <span class="font-bold <%= color_class.sub('bg-', 'text-') %>"><%= @consultation.risk_score %>%</span>
            </div>
          </div>

          <!-- 模範解答（AIレスポンス） -->
          <div>
            <p class="font-bold text-gray-700 mb-1">【アドバイス】</p>
            <%= simple_format(@consultation.ai_response) %>
          </div>
        </div>
        <div class="text-xs text-gray-400 mt-1 ml-1">
          <%= @consultation.created_at.strftime("%H:%M") %>
        </div>
      </div>
    </div>

  </div>
</div>
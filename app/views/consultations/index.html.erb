<div class="max-w-md mx-auto px-4 py-6 pb-24 sm:max-w-2xl">
  <h1 class="text-xl font-bold text-gray-800 mb-6 text-center">ç›¸è«‡ãƒ­ã‚°</h1>

  <% if @consultations.any? %>
    <div class="space-y-3">
      <% @consultations.each do |consultation| %>
        <!-- ã‚«ãƒ¼ãƒ‰æœ¬ä½“ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰ -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer transition-all duration-300" onclick="toggleCard(this)">
          
          <div class="p-4">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ—¥ä»˜ãƒ»ã‚¹ã‚³ã‚¢ãƒ»å‰Šé™¤ï¼‰ -->
            <div class="flex justify-between items-start mb-3">
              <div class="text-xs text-gray-400">
                <%= consultation.created_at.strftime("%Y/%m/%d %H:%M") %>
              </div>
              
              <div class="flex items-center gap-3">
                <!-- ã‚¹ã‚³ã‚¢ -->
                <% score = consultation.risk_score
                   color = score >= 80 ? 'bg-blue-100 text-blue-700' : (score >= 40 ? 'bg-yellow-100 text-yellow-700' : 'bg-red-100 text-red-700') 
                %>
                <span class="px-2 py-0.5 rounded text-xs font-bold <%= color %>">
                  ã”æ©Ÿå«Œåº¦: <%= score %>%
                </span>

                <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ–ãƒªãƒ³ã‚°åœæ­¢ã‚’å…¥ã‚Œã¦ã€ã‚«ãƒ¼ãƒ‰ãŒé–‹ã‹ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰ -->
                <%= button_to consultation_path(consultation), method: :delete, data: { turbo_confirm: "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ" }, onclick: "event.stopPropagation()", class: "text-gray-300 hover:text-red-500 p-1 -mr-2 -mt-2 bg-transparent border-0 cursor-pointer" do %>  
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                  </svg>
                <% end %>
              </div>
            </div>
            
            <!-- ç›¸è«‡å†…å®¹ï¼ˆå¸¸ã«è¡¨ç¤ºï¼‰ -->
            <div class="flex items-start gap-2 mb-2">
              <p class="text-gray-800 font-bold text-sm leading-relaxed">
                <%= consultation.content %>
              </p>
            </div>

            <!-- AIã®å›ç­”ï¼ˆåˆæœŸçŠ¶æ…‹ã¯éš ã™ãƒ»ã¾ãŸã¯ä¸€éƒ¨è¡¨ç¤ºï¼‰ -->
            <!-- closed-content: é–‰ã˜ã¦ã‚‹æ™‚ï¼ˆ1è¡Œã ã‘è¡¨ç¤ºï¼‰ -->
            <div class="closed-content flex items-center gap-2 mt-2 opacity-70">
              <span class="text-lg">ğŸ˜Œ</span>
              <p class="text-xs text-gray-600 line-clamp-1">
                <%= consultation.ai_response %>
              </p>
            </div>

            <!-- open-content: é–‹ã„ãŸæ™‚ï¼ˆå…¨éƒ¨è¡¨ç¤ºï¼‰ -->
            <div class="open-content hidden mt-3 bg-blue-50 p-3 rounded-lg border border-blue-100 animate-fade-in">
              <div class="flex gap-2 mb-1">
                <span class="text-lg">ğŸ˜Œ</span>
                <span class="text-xs font-bold text-blue-600 mt-1">ãŠã™ã™ã‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</span>
              </div>
              <div class="mt-2 text-sm text-gray-700 leading-relaxed whitespace-pre-wrap text-left"><%= consultation.ai_response %></div>
            </div>

            <!-- é–‹é–‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
            <div class="text-center mt-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-300 mx-auto transition-transform duration-300 arrow-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>

          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-10 text-gray-500 bg-white rounded-xl border border-dashed border-gray-300">
      <p>å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
    </div>
  <% end %>
</div>

<script>
  function toggleCard(card) {
    const openContent = card.querySelector('.open-content');
    const closedContent = card.querySelector('.closed-content');
    const arrow = card.querySelector('.arrow-icon');

    if (openContent.classList.contains('hidden')) {
      // é–‹ãå‡¦ç†
      openContent.classList.remove('hidden');
      closedContent.classList.add('hidden');
      arrow.classList.add('rotate-180'); // çŸ¢å°ã‚’å›è»¢
      card.classList.add('ring-2', 'ring-blue-200'); // æ ç·šã‚’å¼·èª¿
    } else {
      // é–‰ã˜ã‚‹å‡¦ç†
      openContent.classList.add('hidden');
      closedContent.classList.remove('hidden');
      arrow.classList.remove('rotate-180');
      card.classList.remove('ring-2', 'ring-blue-200');
    }
  }
</script>

<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-5px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in {
    animation: fadeIn 0.2s ease-out;
  }
</style>